{% extends "exercise_base.html" %}

{% block title %}Add Exercise - Exercise Tracker{% endblock %}

{% block content %}
<div class="animation-fadeIn">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">
                        <i class="fas fa-plus text-success"></i> Add New Exercise
                    </h4>
                    <p class="text-muted mb-0">Create a custom exercise for your workout library</p>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('add_exercise') }}" id="exerciseForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="name" class="form-label">
                                    <i class="fas fa-tag"></i> Exercise Name *
                                </label>
                                <input type="text" class="form-control" id="name" name="name" 
                                       required placeholder="e.g., Push-ups, Squats, Running">
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="category" class="form-label">
                                    <i class="fas fa-list"></i> Category *
                                </label>
                                <select class="form-select" id="category" name="category" required>
                                    <option value="">Select Category</option>
                                    <option value="Strength">Strength Training</option>
                                    <option value="Cardio">Cardiovascular</option>
                                    <option value="Flexibility">Flexibility</option>
                                    <option value="Core">Core Training</option>
                                    <option value="Sports">Sports</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="muscle_group" class="form-label">
                                    <i class="fas fa-muscle"></i> Primary Muscle Group *
                                </label>
                                <select class="form-select" id="muscle_group" name="muscle_group" required>
                                    <option value="">Select Muscle Group</option>
                                    <option value="Chest">Chest</option>
                                    <option value="Back">Back</option>
                                    <option value="Shoulders">Shoulders</option>
                                    <option value="Arms">Arms</option>
                                    <option value="Legs">Legs</option>
                                    <option value="Core">Core</option>
                                    <option value="Full Body">Full Body</option>
                                    <option value="Glutes">Glutes</option>
                                    <option value="Calves">Calves</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="difficulty" class="form-label">
                                    <i class="fas fa-signal"></i> Difficulty Level
                                </label>
                                <select class="form-select" id="difficulty" name="difficulty">
                                    <option value="Beginner">Beginner</option>
                                    <option value="Intermediate" selected>Intermediate</option>
                                    <option value="Advanced">Advanced</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="equipment" class="form-label">
                                <i class="fas fa-tools"></i> Equipment Required
                            </label>
                            <input type="text" class="form-control" id="equipment" name="equipment" 
                                   placeholder="e.g., Dumbbells, Barbell, None">
                            <div class="form-text">Leave empty or write "None" if no equipment is needed</div>
                        </div>

                        <div class="mb-4">
                            <label for="instructions" class="form-label">
                                <i class="fas fa-list-ol"></i> Exercise Instructions
                            </label>
                            <textarea class="form-control" id="instructions" name="instructions" 
                                      rows="4" placeholder="Describe how to perform this exercise..."></textarea>
                            <div class="form-text">Provide clear, step-by-step instructions for proper form</div>
                        </div>

                        <!-- Exercise Preview -->
                        <div class="card bg-light mb-4" id="exercisePreview">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="fas fa-eye"></i> Exercise Preview
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-8">
                                        <h6 id="previewName">Exercise Name</h6>
                                        <div class="mb-2">
                                            <span class="badge badge-custom me-1" id="previewCategory">Category</span>
                                            <span class="badge badge-custom" id="previewMuscle">Muscle Group</span>
                                        </div>
                                        <p class="text-muted mb-0" id="previewEquipment">Equipment: None</p>
                                    </div>
                                    <div class="col-md-4 text-end">
                                        <span class="badge bg-primary" id="previewDifficulty">Intermediate</span>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <p class="mb-0" id="previewInstructions">Instructions will appear here...</p>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between">
                            <a href="{{ url_for('exercises') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left"></i> Back to Exercises
                            </a>
                            <div>
                                <button type="reset" class="btn btn-outline-warning me-2">
                                    <i class="fas fa-undo"></i> Reset Form
                                </button>
                                <button type="submit" class="btn btn-gradient">
                                    <i class="fas fa-save"></i> Save Exercise
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Quick Tips Card -->
            <div class="card mt-4">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-lightbulb text-warning"></i> Tips for Adding Exercises
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Naming Guidelines:</h6>
                            <ul class="small">
                                <li>Use clear, descriptive names</li>
                                <li>Include variations (e.g., "Incline Push-ups")</li>
                                <li>Avoid abbreviations when possible</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>Instruction Tips:</h6>
                            <ul class="small">
                                <li>Start with starting position</li>
                                <li>Describe the movement clearly</li>
                                <li>Include safety notes</li>
                                <li>Mention common mistakes to avoid</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Real-time preview update
function updatePreview() {
    const name = document.getElementById('name').value || 'Exercise Name';
    const category = document.getElementById('category').value || 'Category';
    const muscleGroup = document.getElementById('muscle_group').value || 'Muscle Group';
    const difficulty = document.getElementById('difficulty').value || 'Intermediate';
    const equipment = document.getElementById('equipment').value || 'None';
    const instructions = document.getElementById('instructions').value || 'Instructions will appear here...';

    document.getElementById('previewName').textContent = name;
    document.getElementById('previewCategory').textContent = category;
    document.getElementById('previewMuscle').textContent = muscleGroup;
    document.getElementById('previewDifficulty').textContent = difficulty;
    document.getElementById('previewEquipment').textContent = `Equipment: ${equipment}`;
    document.getElementById('previewInstructions').textContent = instructions;
}

// Add event listeners for real-time preview
document.addEventListener('DOMContentLoaded', function() {
    const formInputs = ['name', 'category', 'muscle_group', 'difficulty', 'equipment', 'instructions'];
    
    formInputs.forEach(inputId => {
        const element = document.getElementById(inputId);
        element.addEventListener('input', updatePreview);
        element.addEventListener('change', updatePreview);
    });

    // Initial preview update
    updatePreview();
});

// Form validation
document.getElementById('exerciseForm').addEventListener('submit', function(e) {
    const name = document.getElementById('name').value.trim();
    const category = document.getElementById('category').value;
    const muscleGroup = document.getElementById('muscle_group').value;

    if (!name) {
        e.preventDefault();
        showToast('Please enter an exercise name', 'danger');
        document.getElementById('name').focus();
        return;
    }

    if (!category) {
        e.preventDefault();
        showToast('Please select a category', 'danger');
        document.getElementById('category').focus();
        return;
    }

    if (!muscleGroup) {
        e.preventDefault();
        showToast('Please select a muscle group', 'danger');
        document.getElementById('muscle_group').focus();
        return;
    }

    // Show loading state
    const submitBtn = this.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
    submitBtn.disabled = true;

    // Re-enable button after form submission (in case of errors)
    setTimeout(() => {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }, 3000);
});

// Reset form functionality
document.querySelector('button[type="reset"]').addEventListener('click', function() {
    setTimeout(updatePreview, 50); // Small delay to let form reset
});

// Equipment suggestions
const equipmentSuggestions = [
    'None', 'Dumbbells', 'Barbell', 'Resistance Bands', 'Kettlebell', 
    'Pull-up Bar', 'Medicine Ball', 'Yoga Mat', 'Bench', 'Cable Machine'
];

// Add autocomplete to equipment field
document.getElementById('equipment').addEventListener('input', function() {
    // Simple autocomplete could be implemented here
    // For now, we'll just provide the placeholder functionality
});

// Add category-specific muscle group suggestions
document.getElementById('category').addEventListener('change', function() {
    const category = this.value;
    const muscleGroupSelect = document.getElementById('muscle_group');
    
    // Reset muscle group selection
    muscleGroupSelect.value = '';
    
    // Provide contextual hints based on category
    let hint = '';
    switch(category) {
        case 'Strength':
            hint = 'Common for strength: Chest, Back, Arms, Legs';
            break;
        case 'Cardio':
            hint = 'Common for cardio: Full Body, Legs';
            break;
        case 'Core':
            hint = 'Focus on: Core, Full Body';
            break;
        case 'Flexibility':
            hint = 'Can target: Full Body or specific muscle groups';
            break;
    }
    
    if (hint) {
        showToast(hint, 'info');
    }
});
</script>
{% endblock %}